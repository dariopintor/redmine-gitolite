<h2>Gitolite#index</h2>

<%= error_messages_for :gitolite %>

<% roles = Role.find_all_givable
   members = @project.member_principals.find(:all, :include => [:roles, :principal]).sort %>

<div class="splitcontentleft">
<% if members.any? %>
<table class="list members">
	<thead>
		<tr>
			<th><%= l(:label_user) %> / <%= l(:label_group) %></th>
			<th><%= l(:label_role_plural) %></th>
			<th style="width:15%"></th>
			<%= call_hook(:view_projects_settings_members_table_header, :project => @project) %>
		</tr>
	</thead>
	
	<tbody>
	<% members.each do |member| %>
	<% next if member.new_record? %>
	<tr id="member-<%= member.id %>" class="<%= cycle 'odd', 'even' %> member">
	<td class="<%= member.principal.class.name.downcase %>"><%= link_to_user member.principal %></td>
	<td> </td>
	<td class="buttons">
		<%= link_to_remote(l(:button_delete), { :url => {:controller => 'members', :action => 'destroy', :id => member},                                              
                                              :method => :post,
                                              :confirm => (!User.current.admin? && member.include?(User.current) ? l(:text_own_membership_delete_confirmation) : nil)
                                            }, :title => l(:button_delete),
                                               :class => 'icon icon-del') if member.deletable? %>
  </td>
  <%= call_hook(:view_projects_settings_members_table_row, { :project => @project, :member => member}) %>
	</tr>
<% end; reset_cycle %>
	</tbody>
</table>
<% else %>
<p class="nodata"><%= l(:label_no_data) %></p>
<% end %>
</div>
<div class="splitcontentright">
<% if roles.any? %>
	<% remote_form_for(:member, @member, :url => {:controller => 'members', :action => 'new', :id => @project}, :method => :post,
									   :loading => "$('member-add-submit').disable()",
									   :complete => "$('member-add-submit').enable()",
									   :lang => current_language) do |f| %>
		<fieldset><legend><%=l(:label_member_new)%></legend>
			<p><%= f.text_field :branch, :required => true, :label => :field_branch %></p>

			<p><%= f.check_box :read, :label => :field_read %></p>
			<p><%= f.check_box :write, :label => :field_write %></p>
			<p><%= f.check_box :rewind, :label => :field_rewind %></p>

			<p><%= l(:label_role_plural) %>:
			<% roles.each do |role| %>
				<label><%= check_box_tag 'member[role_ids][]', role.id %> <%=h role %></label>
			<% end %></p>
			
			<p><%= submit_tag l(:button_add), :id => 'member-add-submit' %></p>
		</fieldset>
	<% end %>
<% end %>
</div>
